<html>

<head>
  <title>Homelesssness in San Francisco</title>
  <h1>Homelessness in San Francisco</h1>
  <p>
    This map seeks to provide resources related to homelessness in San Francisco, including heatmaps, proximity to shelters, and more. </p>
  </p>
  <style>
  h1 {
      font-family: Helvetica;
      color: #659dbd;
      text-align: center
    }
  p {
      font-family: Helvetica;
      color: rgb(151, 148, 148);
      text-align: center
    }
  h3 {
      font-family: Helvetica;
      color: #659dbd;
      text-align: center
    }
    h4 {
      font-family: Helvetica;
      color: #659dbd;
      text-align: center
    }
  
  a {
  text-decoration: none;
  color: #2dc4b2;
    }
    #console {
  position: absolute;
  width: 240px;
  margin: 10px;
  padding: 10px 20px;
  background-color: white;
}
.session {
  margin-bottom: 20px;
}

.row {
  height: 12px;
  width: 100%;
}

.colors {
  background: linear-gradient(to right, #8ca2db, #3f558f, #14244f);
  margin-bottom: 5px;
}

.label {
  display: inline;
  text-align: center;
  font-family: Helvetica;
  color: rgb(151, 148, 148);
  padding-right: 32px;
}
  </style>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.5.0/mapbox-gl.css' rel='stylesheet' />
  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.5.0/mapbox-gl.js'></script>

  <style type="text/css">
    #mapId {
      width: 100%;
      height: 700px;
    }

  </style>
</head>

<body>

  
  <div id="mapId"></div>

  <div class="map-overlay top">
    <div class="map-overlay-inner">
      <h2>Number of Homeless Encampents in 2019</h2>
      <label id="month"></label>
      <input id="slider" type="range" min="0" max="11" step="1" value="0" />
    </div>
  </div>

  <h3>Homelessness is on the rise in San Francisco.</h3>
  <p>In 2019, 8,011 homeless individuals were counted in San Francisco.</p>
  <p>This is a 14% increase from 2017.</p>

<!--https://sfgov.org/scorecards/safety-net/homeless-population -->

<div id='console'>
  <h4>Homeless Encampments</h4>
  <p>Data: <a href='https://data.sfgov.org/City-Infrastructure/311-Cases/vw6y-z8j6'>311 Encampment Calls</a> in SF, Jan 2019-Jan 2020</p>
  <div class='session'>
    <h4>Number of Reports</h4>
    <div class='row colors'>
    </div>
    <div class='row labels'>
      <div class='label'>0-100</div>
      <div class='label'>100-750</div>
      <div class='label'>750+</div>
    </div>
  </div>
</div>

  <script>
    mapboxgl.accessToken = "pk.eyJ1IjoiZGFzaGV3IiwiYSI6ImNrNWZ1bjI3djAxNzIzbG9jMXcwNmdiMGoifQ.1VrgWnYzP6H9Ep5EyVMsmA";
  </script>
  
<!--Popups start here -->
  <script>

    var map = new mapboxgl.Map({
      center: [-122.4312, 37.7739],
      zoom: 11.5,
      style: "mapbox://styles/dashew/ck6wl2x5900re1iny9at72r62",
      container: "mapId"
    });

    map.on('load', function () {
  map.on('click', function(e) {
    var features = map.queryRenderedFeatures(e.point, {
      layers: ['services']
    });
    var feature = features[0];
    var popup = new mapboxgl.Popup({ offset: [0, -15] })
            .setLngLat(feature.geometry.coordinates)
            .setHTML('<h4>' + feature.properties.Name + '</h4><p>'+ feature.properties.Description + '</p><p>' + feature.properties.Phone + '</p><a href=feature.properties.Website>' + feature.properties.Website + '</a>' )
            .addTo(map);
    });


});



    var months = [
      'January 2019',
      'February 2019',
      'March 2019',
      'April 2019',
      'May 2019',
      'June 2019',
      'July 2019',
      'August 2019',
      'September 2019',
      'October 2019',
      'November 2019',
      'December 2019',
      'January 2020'
      ];
 
function filterBy(month) {
var filters = ['==', 'month', month];
map.setFilter('clusters', filters);
map.setFilter('cluster-count', filters);
 
// Set the label to the month
document.getElementById('month').textContent = months[month];
}
  </script>

  <script>
    map.on('load', function() {
      map.addSource('homeless', {
        type: 'geojson',
        data: 'https://raw.githubusercontent.com/DashewM/homelessness-project/6bb5b9b1006fda3d7b520864d1628a73fa481dcc/311%201%20year%20geojson.geojson',
        cluster: true,
        clusterMaxZoom: 14,
        clusterRadius: 70,

      });

      map.addLayer({
        id:'clusters',
        type: 'circle',
        source: 'homeless',
        filter: ['has', 'point_count'],
        paint: {
          'circle-color': [
            'step',
            ['get', 'point_count'],
            '#8ca2db',
            100,
            '#3f558f',
            750,
            '#14244f'
          ],
          'circle-radius': [
            'step',
            ['get', 'point_count'],
            20,
            100,
            30,
            750,
            40
          ]
        }
      });

      map.addLayer({
        id: 'cluster-count',
        type: 'symbol',
        source: 'homeless',
        filter: ['has', 'point_count'],
        layout: {
          'text-field': '{point_count_abbreviated}',
          'text-font': ['DIN Offc Pro Medium', 'Arial Unicode MS Bold'],
          'text-size': 12,
        },
        'paint':{
          'text-color': '#fff'
        }
      });
      map.addLayer({
        id: 'unclustered-point',
        type: 'circle',
        source: 'homeless',
        filter: ['!', ['has', 'point_count']],
        paint: {
        'circle-color': '#9bb3f2',
        'circle-radius': 4,
        'circle-stroke-width': 1,
        'circle-stroke-color': '#fff'
        }
      });
      map.on('click', 'clusters', function(e) {
        var features = map.queryRenderedFeatures(e.point, {
        layers: ['clusters']
        });
        var clusterId = features[0].properties.cluster_id;
          map.getSource('homeless').getClusterExpansionZoom(
          clusterId,
          function(err, zoom) {
          if (err) return;
          
          map.easeTo({
          center: features[0].geometry.coordinates,
          zoom: zoom
            });
          }
        );
      });
      map.on('mouseenter', 'clusters', function() {
        map.getCanvas().style.cursor = 'pointer';
        });
      map.on('mouseleave', 'clusters', function() {
        map.getCanvas().style.cursor = '';
        });



    });

  </script>
</body>

</html>